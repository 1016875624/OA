# OA自动化办公需求分析

[TOC]



## 摆正心态

	关于这次实训，我想将它作为一个可以作为我们面试的加分点的东西，所以这次我想玩一些比较新颖的东西，当然可能这会有一定的难度，但是这次是我们大四的最后一次课程了，此时不拼，更待何时。
	
	首先我们要摆正我们的心态，毕竟有两个月的时间在里面，没有什么是做不到的。还有一点，其实在企业中工作，一些人给你提需求的时候，别人并不会考虑你会不会这个技术，他只是把需求给你，然后其他的全部你自己设计，当然他可能会给多点时间给你，让你去弥补你现在的技术缺陷。所以我们的这个实训其实是跟企业里的工作差不多的。
	
	这次实训的项目，当然不会全部都是难的东西，有一部分是简单的，毕竟项目都是差不多的，不同的只是不同的业务场景，不同的业务逻辑；相同的业务用不同的技术去实现罢了，所以项目还是有很多简单的地方的，所以不用特别害怕。
	
	最后，希望大家能够互相帮助。遇到问题的时候，首先自己看下怎么解决，确实解决不了的时候再去问组员，组员可以帮你解决问题。不过切记一点，遇到同样的问题，必须在问过一次的情况下，能够自己解决，起码要和上次出现错误的场景不同，当然如果实在解决不了，那就直接问组员吧。相信这一次，我们要做出努力，绽放自己的光彩，争取能把这个项目作为以后找工作的亮点。

## 模块划分

### 工时统计

1. 员工填报工时
2. 相关负责人审核
3. 员工申请离职后的工时计算等
4. 员工的请假要扣减相应的工时

### 请假系统

这里主要用到的是发送邮件和消息提醒的功能，希望大家能够做好

1. 员工申请请假(这里采用 发送邮件进行提醒负责人，当然，最好就是在办公系统也能做到消息提醒)
2. 负责人进行审核(不论批假还是不批，都应该发送邮件给请假人发送结果，当然，最好就是在办公系统也能做到消息提醒)
3. 请假成功后向相应的组员发送提醒，然后让相应的组员能够帮忙做一下请假人的工作

### 薪资管理

工资的增删改查

1. 工资自动增长机制，通过工龄自动加相应的工资
2. 工资通过员工的绩效，发放相应的奖金，基础工资也会相应的提高
3. (**难点**)员工申请加薪，然后随机出题，让员工进行回答，可以是选择题，填空题，问答题(人工审批)，编程题(做最简单的)等，当员工能把题目做到一定的程度，这个申请才会到达审批人手里，然后审批人负责再次查阅答题情况，视情况加薪。

### 办公资源管理

这里想的是办公室的申请，公用车的分配等 办公资源管理

这里可以玩很多的形式，例如抢相应的资源，谁的手速快，办公资源就归谁。(**高并发**)

抽奖形式，可以分配一些额度给一定的人，然后大家用额度去进行抽奖，没有抽中的返回相应的额度，额度每天都会增加。然后就是进行随机抽奖，抽到谁，办公资源就归谁。

最后当然少不了的就是办公资源的人工分配

### 员工管理模块

1. 登录和注销
2. 权限控制
3. 记录员工的所有对数据库有修改的动作
4. 员工的部门管理，员工可以申请调离部门等

## 详细设计

### 工时统计

#### 员工填报工时

填报前提：登录状态，没有登录的用户要被拦截

员工可填报工时=一个月的工作日* 工作时间-请假时长

(难点)要自动的(联网)查询工作日，非工作日的时间不能填报工时

api接口

http://api.goseek.cn/Tools/holiday?date=20181008

免费申请nowapi的接口300次1小时免费试用

https://www.nowapi.com/api/life.workday

为了不让我们的接口浪费掉了，所以我们查询了api以后 要将数据存入到数据库中，每次查询工作日的时候，首先查询数据库中是否有相关的数据，没有的话再进行api调用，调用后把数据存入到我们的数据库中

![工时填报](img/工时填报.jpg)



#### 相关负责人审核

首先这里有一个关系，也就是部门负责人和员工之间的关系

部门负责人 进行部门内的人进行工时审批。当有审批任务的时候可以进行消息推送

![审批工时](img/审批工时.jpg)



#### 员工申请离职后的工时计算等

员工申请离职的时候，禁止员工继续填报工时，并且给账户一个有效期，在有效期过后自动封禁账户。离职的时候除了查询功能还能做之外，其他的所有功能都应该禁止。

#### 员工的请假要扣减相应的工时

就在请假的列表里，禁止员工填报

### 请假模块

#### 员工申请请假

员工输入请假的日期，自动的计算请假的天数，提交到服务器中，服务器通过邮件通知相关的人进行审核，24小时内未审批，则为申请成功。邮件里面放一个html ，负责人可以在邮件中的HTML进行审批，审批后提醒审批成功，同时通知到相应的员工。

具体实现：点击的是一个get请求，里面包含一个参数token，点击的时候回发送这个token值，然后通过token，查询到相应的请假， 然后进行审批。

除了邮件进行审批，也可以在系统中进行审批 所以这里需要一个数据表格

![请假申请](img/请假申请.jpg)



![审批请假](img/审批请假.jpg)



### 薪资管理

设计一个`部门`表，里面有所有部门

设计一个`职员`表，里面存放所有的职员的信息和名单。

设计一个`官职`表，里面有各部门所有的官职信息

薪资必须通过本部门专门管理薪资的人进行修改

当然也可以由部门之上的管理人通知提薪，然后本部门的人进行执行。

新增职员的时候，他的薪资由人工设定

员工可以查看自己的薪资，员工可以看到自己下个月将会获得的工资

每个小组要进行每个月的绩效评定，所以会有一个`绩效`的表

这里还要涉及到工龄的计算

随机出题，可以出单选题，多选题，填空题，甚至是编程题，最后一个如果能做尽量做



![涨薪申请](img/涨薪申请.jpg)



### 办公资源管理

以抢的形式进行办公分配，所以这里会涉及到高并发，那么怎么进行高并发的设计呢？查看过一些资料，了解到目前并发的瓶颈是数据库的处理速度。12306一到春运的时候就会有很多网友在订票，当时他们为了解决这个并发的问题，去找各大数据库厂商，问他们能否解决这么大的并发量，但是没有一个数据库产商能够解决；ddos攻击也可以说是一个拒绝服务攻击，目的让他们的数据库繁忙起来，让真正的客户体验变得不好。逛了这么多的网站，我们也可看到很多网站的搜索都做了一个限制，3s之内不能连续搜索。

所以我们要解决数据库的问题，根据我在实验室的电脑测试过，插入数据1s中的并发量大概有750左右，但是查询的速度将会更慢。在实验室中，不进行数据库操作的1s并发量是7500左右，所以我们的并发量就做到4000左右。

首先先用一个redis保存一些中间结果，等抢结束后，在进行持久化到数据库中。

抽奖的形式进行争夺办公资源争抢，大家应该都玩过1元夺宝吧，就是使用这种形式进行抽奖。所以我们要给每个能申请的人给他们一定的抽奖值，然后让他们付出一定的抽奖值进行抽奖，抽中的人才会扣减值，没有抽中的抽奖值自动返还到原账户

![抢办公资源](img/抢办公资源.jpg)



#### 办公资源抽奖算法

总的值=所有额度值

随机抽取一个数在0-总的值

然后分为两半 一般为0-随机值 另一半为随机值-总的值

随机出一个数在0和1之间

0则选0-随机值

1则选随机值-总

依次类推，直到剩下最后一个



![抽办公资源](img/抽办公资源.jpg)



#### 办公资源买卖

谁也不能保证每次都抢到，谁也不能保证每次都抽到，就算是人工审批的申请，也会有不如意的时候，所以我们就做个买卖。让那些抢到资源的人可以卖出来赚部门外快，当然也可以让那些紧急使用的人可以获得办公资源，一举两得。





### 员工管理模块

增删改查

#### 登录

验证码可以是邮件，图片，登录密码要进行加密验证，Spring Security 里面有专门的密码加密器，spring设计的时候是防止暴力破解的，所以它的加密时间特别长，大概需要1s的时间才能加密1个密码，当然它也提供了接口，让我们自己去进行加密的操作

![登录](img/登录.jpg)

![注销](img/注销.jpg)





#### 权限控制

使用spring security进行权限控制，包括url拦截，方法拦截，基于html的拦截的话，好像并没有多大的作用，有时间的话可以试着来一下。

#### 操作记录

可以用AOP进行@Slf4j日记的记录

当然也可以在它操作数据库的时候先把操作存进数据库中

##  数据表格

### 部门表

| 字段名(field) | 类型    | 描述     |
| ------------- | ------- | -------- |
| id            | Integer | id       |
| name          | String  | 部门名称 |



#### 员工表

| 字段名(field) | 类型    | 描述                         |
| ------------- | ------- | ---------------------------- |
| id            | Long    | 员工id                       |
| employeeNo    | String  | 员工号                       |
| password      | String  | 密码(存储的密码以加密的形式) |
| departmentId  | Integer | 部门id                       |
| name          | String  | 姓名                         |
| email         | String  | 邮箱                         |
| entryTime     | Date    | 入职时间                     |

### 部门任职表

| 字段名(field) | 类型    | 描述         |
| ------------- | ------- | ------------ |
| departmentId  | Integer | 部门id(外键) |
| employeeId    | Long    | 员工id       |
| position      | String  | 职位         |

### role角色表不要

在用户里面查看职位即可

### 权限表

后续设计







